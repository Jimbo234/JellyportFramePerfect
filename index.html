<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jellyport Practice</title>
    
    <style>
      * {
        margin: 0;
      }
      body {
        background-color: rgb(17, 17, 17);
        color: white;
      }
      canvas {
        padding: 0;
      }
    </style>
    
    <script>
      function init(){
        canvas = document.getElementById("frameperfect");
        ctx = canvas.getContext("2d");
        
        screenwidth = window.innerWidth;
        screenheight = window.innerHeight;
        
        canvas.width = screenwidth;
        canvas.height = screenheight;
        
        red = 17;
        green = 17;
        blue = 17;
        
        r = 17;
        g = 17;
        b = 17;
        
        x = 0;
        timeRunning = false;
        timer = 0;
        streak = 0;
        high = 0;
        
        whip = 0;
        door = 0;
        
        tries = 0;
        successes = 0;
        
        controlsInitialized = false;
        
        document.addEventListener('keydown', function(event) {
          
          var keypress = event.keyCode
          if (controlsInitialized){
            if(event.keyCode == whip) {
              timer = 1;
              timeRunning = true;
            }
            else if(event.keyCode == door) {
              if (timeRunning){
                timeRunning = false;
                display(timer);
                timer = 0;
              }
            }
          }
          else {
            if (whip == 0){
              whip = event.keyCode;
              drawInstruct();
            }
            else {
              door = event.keyCode;
              controlsInitialized = true;
              ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
          }
          
        });
        
        drawInstruct();
        
        setInterval(function(){
            if (timeRunning){
              timer--;
            }
            
            screenwidth = window.innerWidth;
            screenheight = window.innerHeight;
            
            if (canvas.height != screenheight || canvas.width != screenwidth){
              canvas.width = screenwidth;
              canvas.height = screenheight;
              drawText();
              if (controlsInitialized === false){
                drawInstruct();
              }
            }
            
            funkyColor();
        }, (1000/60));
      }
      
      function display(time){
        delay = (time * (1/60))*1000;
        response = "Perfect!";
        tries++;
        successes++
        streak++;
        r = 37;
        g = 240;
        b = 69;
        
        if (delay > 0){
          response = "Too early!";
          streak = 0;
          successes--;
          r = 230;
          g = 220;
          b = 34;

        }
        if (delay < 0){
          response = "Too late!";
          streak = 0;
          successes--;
          r = 245; 
          g = 90; 
          b = 66;
        }
        delay = Math.abs(delay);
        delay = delay.toFixed(2);
        delay = delay + "ms"
        
        if (streak > 1){
          r = 168; 
          g = 52;
          b = 235;
        }
        if (streak > high){
          high = streak;
        }
        
        drawText();
      }
      function drawInstruct(){
        centerx = canvas.width/2
        centery = canvas.height/2
        
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "60px Arial";
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (whip == 0){
          ctx.fillText("Press your whip button!", centerx, centery + 40);
        }
        else {
          ctx.fillText("Press your door button!", centerx, centery + 40);
        }
      }
      function drawText(){
        centerx = canvas.width/2
        centery = canvas.height/2
        
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.font = "60px Arial";
        ctx.fillText(delay, centerx, centery);
        
        ctx.font = "30px Arial";
        
        ctx.fillText(response, centerx, centery + 40);
        
        ctx.fillText("High Score: " + high, centerx, centery + 160);
        if (streak > 1){
          ctx.fillText(streak + " streak.", centerx, centery + 80);
        }
        
        ctx.textAlign = "left";
        ctx.fillText(((successes/tries)*100).toFixed(2)+"% of "+tries, 4, canvas.height-6)
      }
      
      function funkyColor(){
        colorChanged = false;
        for (i=1; i < 5; i++){
          if (r < red){
            colorChanged = true;
            red--;
          }
          if (r > red){
            colorChanged = true;
            red++;
          }
          if (b < blue){
            colorChanged = true;
            blue--;
          }
          if (b > blue){
            colorChanged = true;
            blue++;
          }
          if (g < green){
            colorChanged = true;
            green--;
          }
          if (g > green){
            colorChanged = true;
            green++;
          }
        }
        if (colorChanged){
          canvas.style = "background-color:rgb("+red+","+green+","+blue+");"
        }
      }
    </script>
</head>
<body onload="init()">
  <canvas id="frameperfect" width="400" height="400"></canvas>
</body>
</html>
